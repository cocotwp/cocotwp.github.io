---
layout: article
title: Spark SQL II
tags: 
- Spark
- 黑马
toc: true
---

## SparkSQL 的运行流程

### SparkRDD 的执行流程回顾

<div align="center">
	<img src="https://raw.githubusercontent.com/cocotwp/cocotwp.github.io/master/assets/images/sparkSQL/RDD的执行流程回顾.png" alt="RDD的执行流程回顾" width="50%" />
</div>

1. driver 提交任务
2. DAG 调度器逻辑任务
3. Task 调度器任务分配和管理监控
4. Worker 干活

### SparkSQL 的自动优化

RDD 的运行会完全按照开发者的代码运行，如果开发者水平有限，RDD 的执行效率也会受到影响。\
而 SparkSQL 会对代码执行“自动优化”，以提高代码运行效率。

DataFrame 可以被优化，是因为它固定是二维表结构，而 RDD 内的数据类型是不固定的。\
SparkSQL 的*自动优化*依赖于 **Catalysty优化器**

### Catalyst 优化器

<div align="center">
	<img src="https://raw.githubusercontent.com/cocotwp/cocotwp.github.io/master/assets/images/sparkSQL/SparkSQL优化执行流程.png" alt="SparkSQL优化执行流程" width="95%" />
</div>

1. 解析 SQL，并且生成 AST（抽象语法树）
2. 在 AST 中加入元数据信息，为优化做准备
3. 对已经加入元数据的 AST，输入优化器，进行优化。
	- 谓词下推（Predicate Pushdown）：



### SparkSQL 的执行流程

## SparkSQL 整合 Hive

## 分布式 SQL 引擎配置